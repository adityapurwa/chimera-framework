verbose: true
vars:
    config: "{\"mongo_url\":\"mongodb://localhost/project-template\", \"table\":\"person\", \"history\":\"hperson\"}" 
    sharingan_config: "{\"mongo_url\":\"mongodb://localhost/project-template\", \"table\":\"person\", \"history\":\"hperson\", \"show_deleted\":true}" 
    sharingan_projection: "{\"name\":1, \"alias\":1, \"hperson\":1, \"_deleted\":1}"
    user: "u001"
    new_data: "{\"name\":\"Tono Stark\", \"alias\":\"Ironman\"}"
    newer_data: "{\"name\":\"Toni Stark\"}"
series:
    # insert new data
    - ("insert", config, new_data, user) -> node cck.crud.js -> insert_result_1
    - (insert_result_1.row._id) -> echo -> pkValue1
    - ("getOne", config, pkValue1, user) -> node cck.crud.js -> get_one_result
    # update inserted data with a newer one
    - ("update", config, pkValue1, newer_data, user) -> node cck.crud.js -> update_result
    # insert another data
    - ("insert", config, new_data, user) -> node cck.crud.js -> insert_result_2
    - (insert_result_2.row._id) -> echo -> pkValue2
    # delete the last one
    - ("delete", config, pkValue2, user) -> node cck.crud.js -> delete_result
    # get the data
    - ("get", config) -> node cck.crud.js -> get_result
    # get it with sharingan activated ...
    - ("get", sharingan_config, "{}", sharingan_projection) -> node cck.crud.js -> get_sharingan_result
    # show the result
    - ins: insert_result_1, get_one_result, update_result, insert_result_2, delete_result, get_result, get_sharingan_result, config
      command: |
          (insert_result_1, get_one_result, update_result, insert_result_2, delete_result, get_result, get_sharingan_result, config) => {
              let output = '\n'
              output += '* Insert Result 1\n'
              output += JSON.stringify(insert_result_1, null, 2)+'\n\n'
              output += '* Get One Result 1\n'
              output += JSON.stringify(get_one_result, null, 2)+'\n\n'
              output += '* Update Result\n'
              output += JSON.stringify(update_result, null, 2)+'\n\n'
              output += '* Insert Result 2\n'
              output += JSON.stringify(insert_result_2, null, 2)+'\n\n'
              output += '* Delete Result\n'
              output += JSON.stringify(delete_result, null, 2)+'\n\n'
              output += '* Get Result\n'
              output += JSON.stringify(get_result, null, 2)+'\n\n'
              output += '* Get Sharingan Result\n'
              output += JSON.stringify(get_sharingan_result, null, 2)+'\n\n'
              return output
          }
